---
date: 2026-02-23
title: 'Polyoracle V1：比通讯社更快地捕捉有效信号'
tags: [
  'Algorithm',
  'Finance'
]
language: 'zh'
---

## 引言

[Polymarket](https://polymarket.com) 是一个基于 USDC 的预测市场平台，每个市场的价格直接对应真实资金押注的概率估计。与新闻不同，市场价格由套利者持续修正，理论上能比通讯社更早反映新信息的涌入。与此同时，一些内部人士可以通过信息优势，从而获得「不公平」的优势。那么，如果我们能捕捉到内部人士的交易信号，是否能对社会的变化更加敏锐呢？

问题是：Polymarket 同时挂载着数千个市场，大多数时候价格纹丝不动，偶尔有真实信号也淹没在噪声里。[Polyoracle](https://github.com/rewired-gh/polyoracle) 要解决的问题很具体：从实时数据流中自动识别哪些概率移动值得关注，并推送 Telegram 提醒。

本文记录评分系统的算法设计——更准确地说，是一系列失败尝试的修正历史。

## 第一次尝试：原始幅度

最直觉的方案是直接用绝对变动量 $|\Delta p|$ 排序，超过某个阈值就报警。这个方案的问题在几小时内就会暴露：

**问题一：概率尺度不均匀。** 从 0.01 移动到 0.02，和从 0.50 移动到 0.51，$|\Delta p|$ 都是 0.01，但前者意味着市场对某事件的信念翻了一倍，后者几乎是无意义的波动。

**问题二：流动性的干扰。** 一个总成交量只有几百美元的市场，单笔交易就能把价格推动 20%；而一个千万美元量级的市场移动 5% 背后是真实的资金流动和信息更新。两者的 $|\Delta p|$ 可以一样大，但信号质量天差地别。

**问题三：忽视历史波动基准。** 一贯剧烈震荡的市场突然移动了 3%，可能什么都没发生；一个长期稳定的市场同样移动 3%，往往意味着有实质性信息涌入。

这三个问题分别指向三个独立的修正方向。

## 用 KL 散度衡量信息量

对于二元市场（YES/NO），从旧概率 $p_{\text{old}}$ 到新概率 $p_{\text{new}}$ 的信息量变化可以用 KL 散度衡量：

$$
D_{\mathrm{KL}}(p_{\text{new}} \| p_{\text{old}}) = p_{\text{new}} \ln \frac{p_{\text{new}}}{p_{\text{old}}} + (1 - p_{\text{new}}) \ln \frac{1 - p_{\text{new}}}{1 - p_{\text{old}}}
$$

这解决了问题一。$p: 0.01 \to 0.02$ 的 KL 散度约为 0.0069，而 $p: 0.50 \to 0.51$ 的 KL 散度约为 0.0001，前者是后者的 69 倍——符合直觉。

实现上需要将概率 clamp 到 $[10^{-7},\, 1 - 10^{-7}]$，避免 $\ln 0$ 的数值异常。

## 对数成交量权重

为每个市场引入成交量权重：

$$
w = \max\!\left(0.1,\; \log_2\!\left(1 + \frac{V_{24\text{h}}}{V_{\text{ref}}}\right)\right)
$$

其中 $V_{\text{ref}}$ 为参考成交量（默认 25,000 USDC）。

对数压缩的效果是抑制大市场的过度主导：$V = 4V_{\text{ref}}$ 时 $w \approx 2.32$，而非线性函数给出的 4 倍。floor $0.1$ 确保新市场在成交量数据积累之前不会被完全压制。

## 历史信噪比（SNR）

对每个市场维护全量历史快照，计算相邻快照差分序列 $\{\Delta p_i\}$ 的样本标准差（Bessel 修正，除以 $n-1$）：

$$
\sigma = \sqrt{\frac{\sum_{i} (\Delta p_i - \bar{\Delta p})^2}{n - 1}}
$$

当前变动相对于历史噪声的倍数即为 SNR：

$$
\mathrm{SNR} = \mathrm{clamp}\!\left(\frac{|\Delta p_{\text{net}}|}{\sigma},\; 0.5,\; 5.0\right)
$$

上下界的意义：clamp 到 $[0.5, 5.0]$ 防止极端值主导合成分数，也避免信噪比极低时信号被完全清零。当快照不足以计算 $\sigma$（少于 2 个差分对）或 $\sigma < 10^{-4}$ 时，回退到 $\mathrm{SNR} = 1.0$。

## 轨迹一致性

$\mathrm{SNR}$ 衡量的是「变动有多大」，但无法区分一路单调上涨的 $0.50 \to 0.52 \to 0.55 \to 0.58$ 和震荡后回归的 $0.50 \to 0.72 \to 0.38 \to 0.58$——后者的净变动相同，但充满噪声。

轨迹一致性（Trajectory Consistency）衡量检测窗口内路径的方向纯度：

$$
\mathrm{TC} = \frac{\left|\sum_i \Delta p_i\right|}{\sum_i |\Delta p_i|}
$$

完全单向移动时 $\mathrm{TC} = 1$，来回震荡时 $\mathrm{TC} \to 0$。

## 合成评分

将四个因子相乘：

$$
\text{score} = D_{\mathrm{KL}} \times w \times \mathrm{SNR} \times \mathrm{TC}
$$

最低分阈值由可配置的灵敏度参数控制：

$$
\text{minScore} = \text{sensitivity}^2 \times 0.05
$$

在 500 个真实事件、8,219 个市场的测试中，合成分数在真实信号和噪声底层之间实现了约 130 倍的动态范围。消融实验结果：移除成交量权重使误报增加 88%，移除 SNR 因子使 61% 的真实信号被漏报。

## 检测流水线

评分是核心，但完整系统还需要几个关键机制：

- 采样窗口：检测窗口为 $(\text{周期数} + 1) \times \text{轮询间隔}$，多出的一个间隔用于吸收处理延迟，避免边界快照被意外排除。
- 硬过滤：评分之前先排除绝对变动 $< 1\%$ 的市场（KL 计算在这个量级意义有限），以及基础概率 $< 5\%$ 的长尾市场（KL 在尾部区域对噪声过度敏感）。例外：进入「确定性区间」（概率穿越 95% 或 5%）的市场绕过此过滤。
- 分组与排名：同一事件（Event）下的多个市场按分数降序排列，事件组按组内最高分排名，最终推送 Top-K 组。
- 冷却去重：相同市场相同方向的变动在冷却窗口内只推送一次。例外：方向反转，或进入高置信区间（$> 90\%$ 或 $< 10\%$），这两种情况强制推送。

## 项目信息

- GitHub：<https://github.com/rewired-gh/polyoracle>
